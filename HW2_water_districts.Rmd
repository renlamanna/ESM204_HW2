---
title: "Hw 2 - water dsitricts"
author: "Renee LaManna, Alia Ajina"
date: "4/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
library(cowplot)
library(patchwork)
library(ggplot2)
library(ggpubr)
```

```{r}
mac <- read_csv(here("data", "water_districts.csv")) %>% 
  clean_names

```

```{r}

```



```{r}
mac_longer <- pivot_longer(data = mac,
                             cols = mc_kern:mc_ventura,
                             names_to = "district",
                             values_to = "mc")
```

```{r}
ggplot(data = mac_longer, aes(x = reduction, y = mc)) +
  geom_point(size = .6, aes(color = district)) +
  theme_minimal() +
  geom_smooth(aes(color = district)) + 
  # stat_regline_equation(label.x=80, label.y=70) 
  labs(y = "Price ($/Acre Foot)", x = "Acre Foot")


  
```


```{r}
# linear models for each district

lm_kern <- lm(mc_kern~0+reduction, data = mac)
lm_mojave <- lm(mc_mojave~0+reduction, data = mac)
lm_antelope <- lm(mc_antelope~0+reduction, data = mac)
lm_ventura <- lm(mc_ventura~0+reduction, data = mac)

lm_kern
lm_mojave 
lm_antelope
lm_ventura
```

``` {r}
# fitting line for kern
mod.kern <- lm(mc_kern ~ 0 + reduction, data = mac)
kern.baseline <- 150
kern_data <- tibble(reduction = 0:150) # create vector of equally spaced numbers
predicted_mc <- predict(mod.kern, newdata = kern_data)
kern_data <- kern_data %>% mutate(predicted_mc = predicted_mc)

# plotting predicted line
ggplot(mac, aes(x=reduction, y = mc_kern)) +
  geom_point() +
  geom_line(data = kern_data, aes(x = reduction, y = predicted_mc))
```

```{r}
# fitting line for kern
mod.mojave <- lm(mc_mojave ~ 0 + reduction, data = mac)
mojave.baseline <-140
mojave_data <- tibble(reduction = 0:140) # create vector of equally spaced numbers
predicted_mc <- predict(mod.mojave, newdata = mojave_data)
mojave_data <- mojave_data %>% mutate(predicted_mc = predicted_mc)
```



```{r}
# derive districts demand curve or use as baseline (no policy) - abatement
kern_data <- kern_data %>%  mutate(water_demand = kern.baseline-reduction)
mojave_data <- mojave_data %>%  mutate(water_demand = mojave.baseline-reduction)

# Using demand data for kern and mojave, join them into on dataset for plotting

joined_demand <- bind_rows("Mojave" = mojave_data,
                           "Kern" = kern_data, .id = "District")

# plot the demand

ggplot(joined_demand, aes(x=water_demand,y = predicted_mc, color = District)) +
  geom_line() +
  labs(x = "Water Demand (AF)", y = "$/AF") 
```

```{r}
# Demand curves for water

demand_kern <-function(x) 343.5-2.29*x
```

```{r}
ggplot() +
  scale_x_continuous(name="x", limits=c(0,300)) +
  scale_y_continuous(name="y", limits=c(-5,700)) +
  geom_abline(mapping = NULL,
  data = NULL, slope = -2.29,
             intercept = 343.5) +
  geom_abline(slope = -3.8,
              intercept = 532.56) +
  geom_abline(slope = -2.86,
              intercept = 628.76) +
  geom_abline(slope = -1.776, 
              intercept = 435.12)
```



